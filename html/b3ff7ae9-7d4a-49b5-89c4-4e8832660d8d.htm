<html xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp"><head><link rel="SHORTCUT ICON" href="./../icons/favicon.ico" /><style type="text/css">.OH_CodeSnippetContainerTabLeftActive, .OH_CodeSnippetContainerTabLeft,.OH_CodeSnippetContainerTabLeftDisabled { }.OH_CodeSnippetContainerTabRightActive, .OH_CodeSnippetContainerTabRight,.OH_CodeSnippetContainerTabRightDisabled { }.OH_footer { }</style><link rel="stylesheet" type="text/css" href="./../styles/branding.css" /><link rel="stylesheet" type="text/css" href="./../styles/branding-en-US.css" /><style type="text/css">
			body
			{
			border-left:5px solid #e6e6e6;
			overflow-x:scroll;
			overflow-y:scroll;
			}
		</style><script src="./../scripts/branding.js" type="text/javascript"><!----></script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Running Naiad programs on Microsoft Azure</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="b3ff7ae9-7d4a-49b5-89c4-4e8832660d8d" /><meta name="Description" content="Naiad programs can be run on Microsoft Azure using the HDInsight 3.0 platform." /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="'true'" /><link type="text/css" rel="stylesheet" href="./../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"><!----></script><meta name="SelfBranded" content="true" /></head><body onload="onLoad()" class="primary-mtps-offline-document"><div class="OH_outerDiv"><div class="OH_outerContent"><table class="TitleTable"><tr><td class="OH_tdLogoColumn"><img src="./../icons/Help.png" /></td><td class="OH_tdTitleColumn">Running Naiad programs on Microsoft Azure</td><td class="OH_tdRunningTitleColumn">Naiad Help</td></tr></table><div id="mainSection"><div id="mainBody"><span class="introStyle"></span><p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p><div class="introduction"><p>
        Naiad programs can be run on Microsoft Azure using the HDInsight 3.0 platform.
        The same Naiad programs you run on your computer or cluster of computers can be run on Azure with some configuration of your environment, some Azure hints for your program, and a simple loader program.
      </p></div><h3 class="procedureSubHeading">Setting up your environment</h3><div class="subSection"><ol><li><p>Set up powershell and configure Azure using 
            <a class="mtps-external-link" href="http://azure.microsoft.com/en-us/documentation/articles/install-configure-powershell/" target="_blank">these instructions</a>.
            In the "How to: Connect your subcription" item, follow the instructions under "Use the certificate method".
            Ensure that your environment is correctly set up by running <span class="code">Get-AzureSubscription</span> and verifying that your subscription has "IsDefault:True" and information identifying the management certificate.
            </p></li><li><p>
              Create a HDInsight 3.0 cluster using 
              <a class="mtps-external-link" href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-get-started-30/" target="_blank">these instructions</a>.
            </p></li></ol><p>
            These steps can take some time, but while you are waiting you can read ahead to the next section where we learn how we may need to modify a Naiad program to behave well in Azure.
            Technically, no modifications are required of a Naiad program, but when running in Azure your program may need read from and write to resources other than your console or local filesystem.
          </p></div><h3 class="procedureSubHeading">
        Modifying a Naiad program to run well on Azure
      </h3><div class="subSection"><ol><li><p>
              The first step you will want to take is to add a reference to Naiad's Azure support framework.
              This library can be acquired through NuGet.org or compiled from Naiad source.
              Once you have included a reference to <span class="code">Microsoft.Research.Naiad.Azure</span>, you will want to add the following to the top of your program:
            </p><div id="ID0EACBCAAAAA" class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerTabs" id="ID0EACBCAAAAA_tabs"></div><div id="ID0EACBCAAAAA_codecollection" class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EACBCAAAAA_ViewColorized" href="#" onclick="javascript:ExchangeTitleContent('ID0EACBCAAAAA','4')" title="View Colorized" style="display: none">View Colorized</a><a id="ID0EACBCAAAAA_copycode" href="#" onclick="javascript:CopyToClipboard('ID0EACBCAAAAA','4')" title="Copy to Clipboard">Copy to Clipboard</a><a id="ID0EACBCAAAAA_PrintText" class="OH_PrintText" href="#" onclick="javascript:Print('ID0EACBCAAAAA','4')" title="Print">Print</a></div></div><div id="ID0EACBCAAAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre><span class="highlight-keyword">using</span> Microsoft.Research.Naiad.Frameworks.Azure;</pre></div><div id="ID0EACBCAAAAA_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="display: none"><pre>using Microsoft.Research.Naiad.Frameworks.Azure;</pre></div></div></div><script>addSpecificTextLanguageTagSet('ID0EACBCAAAAA');</script></li><li><p>
              Just after creating a new computation, step 1 in the first example, it is good to redirect <span class="code">Console.Out</span> and possibly <span class="code">Console.Error</span> to write to Azure blobs. 
              This can be done by invoking the <span class="code">SetConsoleOut</span> and <span class="code">SetConsoleError</span> methods on a computation's controller.
              These methods require an Azure container, and a format string which accepts one parameter, the process identifier.
              For example, the line
            </p><div id="ID0ECBBCAAAAA" class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerTabs" id="ID0ECBBCAAAAA_tabs"></div><div id="ID0ECBBCAAAAA_codecollection" class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0ECBBCAAAAA_ViewColorized" href="#" onclick="javascript:ExchangeTitleContent('ID0ECBBCAAAAA','4')" title="View Colorized" style="display: none">View Colorized</a><a id="ID0ECBBCAAAAA_copycode" href="#" onclick="javascript:CopyToClipboard('ID0ECBBCAAAAA','4')" title="Copy to Clipboard">Copy to Clipboard</a><a id="ID0ECBBCAAAAA_PrintText" class="OH_PrintText" href="#" onclick="javascript:Print('ID0ECBBCAAAAA','4')" title="Print">Print</a></div></div><div id="ID0ECBBCAAAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre>computation.Controller.SetConsoleOutput(container, <span class="highlight-literal">"naiad/out-{0}.txt"</span>);</pre></div><div id="ID0ECBBCAAAAA_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="display: none"><pre>computation.Controller.SetConsoleOutput(container, "naiad/out-{0}.txt");</pre></div></div></div><script>addSpecificTextLanguageTagSet('ID0ECBBCAAAAA');</script><p>
              would redirect <span class="code">Console.Out</span> for each process to the corresponding Azure blobs where <span class="code">"{0}"</span> is replaced by the process identifier.
            </p><p>
              Importantly, you should also add a <span class="code">Console.Out.Close();</span> line after calling <span class="code">Join</span> on the computation, to ensure that all writes are flushed to Azure before your program exits.
            </p></li><li><p>
              Naiad's Azure framework also contains helper methods to write streams to Azure blobs and read streams from Azure blobs.
              If your Naiad program was previously taking inputs from and writing back to your local file systems, it will want to read them from and write them to Azure blob storage instead.
              Note that your Naiad progams can read from and write to Azure storage even without being run on Azure; the same calls will work on your local computer or cluster, but the data movement is more efficient (and cheaper) when run in Azure.
            </p></li></ol><p>
            These steps are, strictly speaking, optional. 
            Any Naiad program can be run unmodified in Azure, but without access to the console or local filesystems it can be difficult to determine if it has behaved successfully.
          </p></div><h3 class="procedureSubHeading">Running Naiad programs on Azure HDInsight 3.0</h3><div class="subSection"><ol><li><p>
              Install "Naiad - Azure submission tool" from NuGet.org, or build <span class="code">NaiadAzureSubmission.exe</span> from the Naiad source repository.
            </p></li><li><p>
              To see the arguments that Naiad's Azure tools require, run: <span class="code">./NaiadAzureSubmission.exe</span></p></li><li><p>
              Double-check that you have followed the steps above to bind your subscription ID in powershell.
            </p></li><li><p>
              To run a Naiad program in Azure you will need to provide an HDInsight cluster name to <span class="code">NaiadAzureSubmission.exe</span>. 
              If your cluster name is <span class="code">myCluster</span> and your program compiles to <span class="code">NaiadProgram.exe</span>, you would type
            </p><div id="ID0EAABAAAAAA" class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerTabs" id="ID0EAABAAAAAA_tabs"></div><div id="ID0EAABAAAAAA_codecollection" class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EAABAAAAAA_ViewColorized" href="#" onclick="javascript:ExchangeTitleContent('ID0EAABAAAAAA','4')" title="View Colorized" style="display: none">View Colorized</a><a id="ID0EAABAAAAAA_copycode" href="#" onclick="javascript:CopyToClipboard('ID0EAABAAAAAA','4')" title="Copy to Clipboard">Copy to Clipboard</a><a id="ID0EAABAAAAAA_PrintText" class="OH_PrintText" href="#" onclick="javascript:Print('ID0EAABAAAAAA','4')" title="Print">Print</a></div></div><div id="ID0EAABAAAAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre>./NaiadAzureSubmission --cluster myCluster NaiadProgram.exe [args]</pre></div><div id="ID0EAABAAAAAA_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="display: none"><pre>./NaiadAzureSubmission --cluster myCluster NaiadProgram.exe [args]</pre></div></div></div><script>addSpecificTextLanguageTagSet('ID0EAABAAAAAA');</script></li></ol><p>
            If all is working well, your Naiad program should be launched on the corresponding HDInsight cluster, using the number of processes you have specified. 
            When it completes, you should be able to find its outputs in Azure storage at the locations you have specified.
          </p></div></div></div></div></div><div id="OH_footer" class="OH_footer"><p /><div class="OH_feedbacklink"><a href="mailto:naiadquestions@microsoft.com?subject=Naiad+Help+Running+Naiad+programs+on+Microsoft+Azure+100+EN-US&amp;body=Your%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report%2c%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed%2c%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.">Send Feedback</a> on this topic to naiadquestions@microsoft.com.</div></div></body></html>