<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><style type="text/css">.OH_CodeSnippetContainerTabLeftActive, .OH_CodeSnippetContainerTabLeft,.OH_CodeSnippetContainerTabLeftDisabled { }.OH_CodeSnippetContainerTabRightActive, .OH_CodeSnippetContainerTabRight,.OH_CodeSnippetContainerTabRightDisabled { }.OH_footer { }</style><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Running Naiad programs on Microsoft Azure</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="b3ff7ae9-7d4a-49b5-89c4-4e8832660d8d" /><meta name="Description" content="Naiad programs can run on Microsoft Azure using the HDInsight 3.0 platform as a service. This walkthrough describes the helper methods and tools that Naiad includes to help you process data in Azure." /><meta name="Microsoft.Help.ContentType" content="How To" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="OH_outerDiv"><div class="OH_outerContent"><table class="TitleTable"><tr><td class="OH_tdLogoColumn"><img src="../icons/Help.png" /></td><td class="OH_tdTitleColumn">Running Naiad programs on Microsoft Azure</td><td class="OH_tdRunningTitleColumn">Naiad Help</td></tr></table><div id="mainSection"><div id="mainBody"><span class="introStyle"></span><p style="color: #dc143c; font-size: 8.5pt; font-weight: bold;">[This is preliminary documentation and is subject to change.]</p><div class="introduction"><p>
        Naiad programs can run on Microsoft Azure using the HDInsight 3.0 platform as a service.
        This walkthrough describes the helper methods and tools
        that Naiad includes to help you process data in Azure.
      </p></div><h3 class="procedureSubHeading">Setting up your environment</h3><div class="subSection"><ol><li><p>The Naiad tools assume that you have configured Azure PowerShell, and configured the
            PowerShell environment with your Azure subscription.
            Use
            <a href="http://azure.microsoft.com/en-us/documentation/articles/install-configure-powershell/" target="_blank">these instructions</a> to configure Azure PowerShell.
            Under "<a href="http://azure.microsoft.com/en-us/documentation/articles/install-configure-powershell/#Connect" target="_blank">How to: Connect your subscription</a>", follow the instructions under "Use the certificate method".
            To ensure that your environment is correctly set up, run the <span class="code">Get-AzureSubscription</span> cmdlet and verify that your subscription has "IsDefault:True" and information identifying the management certificate.
            </p></li><li><p>
              Create a HDInsight 3.0 cluster using 
              <a href="http://azure.microsoft.com/en-us/documentation/articles/hdinsight-get-started-30/" target="_blank">these instructions</a>. The following instructions assume that you have given your cluster the name <span class="code">mycluster</span>.
            </p></li><li><p>
              Implement a Naiad program, such as the <a href="450c8ec2-65e4-4396-93e8-634e6a2144f4.htm">tutorial Naiad program in this article</a>.
              Although the following instructions are general, for concreteness they assume that you are using the tutorial program.
            </p></li></ol><p>
            The first two steps can take some time, but in the mean time the next section will tell you how
            to modify your Naiad program to take advantage of data stored in Azure.
            </p></div><h3 class="procedureSubHeading">
        Modifying a Naiad program to run well on Azure
      </h3><div class="subSection"><ol><li><p>
              The Naiad distribution includes an Azure Support framework, which includes helper methods
              for accessing Azure Storage. Add a reference to this framework, by installing <a href="http://www.nuget.org/packages/Microsoft.Research.Naiad.AzureSupport/0.4.0-beta" target="_blank">the NuGet package</a>.
              To make use of the Azure Support framework, add the following using statement:
            </p><div class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EABADBCAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EABADBCAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABADBCAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">using</span> Microsoft.Research.Naiad.Frameworks.Azure;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABADBCAAA");</script><p>
              See the <a href="N_Microsoft_Research_Naiad_Frameworks_Azure.htm">Microsoft.Research.Naiad.Frameworks.Azure</a> documentation
              for more details of the helper methods in this framework.
            </p></li><li><p>
              After creating a new <a href="T_Microsoft_Research_Naiad_Computation.htm">Computation</a>,
              it can be useful to redirect <span class="code">Console.Out</span> (and <span class="code">Console.Error</span>) to write to Azure blobs. 
              This can be done by invoking the <a href="M_Microsoft_Research_Naiad_Frameworks_Azure_ConsoleExtensionMethods_SetConsoleOut.htm">SetConsoleOut(Controller, CloudBlobContainer, String)</a> 
              and <a href="M_Microsoft_Research_Naiad_Frameworks_Azure_ConsoleExtensionMethods_SetConsoleError.htm">SetConsoleError(Controller, CloudBlobContainer, String)</a>
              methods on a computation's controller.
              These methods require an Azure container, and a format string which accepts one parameter, the process identifier.
              For example, the lines:
            </p><div class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EACACBCAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EACACBCAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACACBCAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">var</span> container = computation.DefaultBlobContainer(<span class="highlight-literal">"naiad-output"</span>);
computation.Controller.SetConsoleOut(container, <span class="highlight-literal">"naiad/out-{0}.txt"</span>);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACACBCAAA");</script><p>
              would redirect <span class="code">Console.Out</span> for each process to a blob in the <span class="code">naiad-output</span> container where <span class="code">"{0}"</span> in the blob name replaced by the process identifier.
            </p><p>
              To ensure that all writes are flushed to Azure before your program exits, you should also add a <span class="code">Console.Out.Close();</span> line after calling <span class="code">Join</span> on the computation.
            </p></li><li><p>
              The <a href="450c8ec2-65e4-4396-93e8-634e6a2144f4.htm">tutorial Naiad program</a>
              reads lines from the Console, and so we must change this to read data from elsewhere.
              Instead of the loop (step 6), the following lines ingest constant data:
            </p><div class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EABABBCAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EABABBCAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABABBCAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre xml:space="preserve">source.OnNext(<span class="highlight-literal">"hi there"</span>.Split());
source.OnNext(<span class="highlight-literal">"hello there"</span>.Split());
source.OnNext(<span class="highlight-literal">"good bye"</span>.Split());</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABABBCAAA");</script><p>
              Alternatively, the <a href="M_Microsoft_Research_Naiad_Frameworks_Azure_ExtensionMethods_ReadTextFromAzureBlobs.htm">ReadTextFromAzureBlobs(Computation, CloudBlobContainer, String)</a>
              method provides a mechanism to read textual data one line at a time from an Azure blob.
            </p></li><li><p>
              Naiad's <a href="N_Microsoft_Research_Naiad_Frameworks_Azure.htm">Microsoft.Research.Naiad.Frameworks.Azure</a> framework also contains helper methods to write streams to Azure blobs and read streams from Azure blobs.
              If your Naiad program previously took inputs from and wrote outputs to your local file systems, it should be modified to read them from and write them to Azure blob storage instead.
              Note that your Naiad progams can read from and write to Azure storage  without running on Azure; the same calls will work on your local computer or cluster, but the data movement is more efficient (and cheaper) when run in Azure.
            </p></li></ol></div><h3 class="procedureSubHeading">Running Naiad programs on Azure HDInsight 3.0</h3><div class="subSection"><ol><li><p>
              Install "Naiad - Azure submission tool" package from <a href="https://www.nuget.org/packages/Microsoft.Research.Naiad.Cluster.Azure" target="_blank">the NuGet repository</a>.
            </p></li><li><p>
              To see the arguments that Naiad's Azure tools require, run: <span class="code">.\NaiadAzureSubmission.exe</span> with no arguments.
            </p></li><li><p>
              Double-check that you have followed the steps above to bind your Azure subscription ID in Azure PowerShell.
            </p></li><li><p>
              To run a Naiad program in Azure you must provide an HDInsight cluster name to <span class="code">NaiadAzureSubmission.exe</span>. 
              If your cluster name is <span class="code">mycluster</span> and your program compiles to <span class="code">NaiadProgram.exe</span>, you would type
            </p><div class="OH_CodeSnippetContainer"><div class="OH_CodeSnippetContainerCodeCollection"><div class="OH_CodeSnippetToolBar"><div class="OH_CodeSnippetToolBarText"><a id="ID0EAAAABBAAA_copyCode" href="#" onclick="javascript:CopyToClipboard('ID0EAAAABBAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EAAAABBAAA_code_Div1" class="OH_CodeSnippetContainerCode" style="display: block"><pre xml:space="preserve">.\NaiadAzureSubmission --clustername mycluster NaiadProgram.exe [args]</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAAABBAAA");</script></li></ol><p>
            If all is working well, your Naiad program should be launched on the corresponding HDInsight cluster, using the number of processes you have specified. 
            When it completes, you should be able to find its outputs in Azure storage at the locations you have specified.
          </p></div></div></div></div></div><div id="OH_footer" class="OH_footer"><div class="OH_feedbacklink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:naiadquestions%40microsoft.com?Subject=Naiad Help">naiadquestions@microsoft.com</a></div><script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>